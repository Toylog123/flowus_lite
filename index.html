<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowUs Pro V13 - 模块化版</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <svg style="display: none;">
        <symbol id="i-plus" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></symbol>
        <symbol id="i-drag" viewBox="0 0 24 24"><path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></symbol>
        <symbol id="i-trash" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></symbol>
        <symbol id="i-save" viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></symbol>
        <symbol id="i-menu" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></symbol>
        <symbol id="i-file" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></symbol>
    </svg>

    <div id="welcome-screen">
        <div class="welcome-card">
            <h1>FlowUs Pro V13</h1>
            <p>模块化 · 本地优先 · 全功能</p>
            <button class="btn primary" onclick="FileIO.initNew()">新建本地项目</button>
            <button class="btn" onclick="FileIO.initOpen()">打开 .json 文件</button>
            <div id="fallback-input" style="display:none;margin-top:20px"><input type="file" onchange="FileIO.handleLegacyOpen(this)"></div>
        </div>
    </div>

    <div id="app">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <span>PROJECT</span>
                <button class="icon-btn" onclick="App.createPage()">+</button>
            </div>
            <div id="page-list" class="sidebar-list"></div>
            <div class="sidebar-footer"><span id="file-status">未保存</span></div>
        </aside>

        <main id="main">
            <header class="top-bar">
                <button class="icon-btn" onclick="App.toggleSidebar()"><svg><use href="#i-menu"/></svg></button>
                <div id="breadcrumb"></div>
                <div class="actions">
                    <button class="icon-btn" onclick="FileIO.saveFile()" title="保存"><svg><use href="#i-save"/></svg></button>
                    <button class="icon-btn" onclick="App.deletePage()" title="删除"><svg><use href="#i-trash"/></svg></button>
                </div>
            </header>

            <div class="editor-scroller" onclick="App.focusEditor(event)">
                <div class="editor-container">
                    <input type="text" id="page-title" class="page-title" placeholder="无标题页面">
                    <div id="blocks-container"></div>
                    <div class="bottom-trigger" onclick="event.stopPropagation(); App.appendBlock()"></div>
                </div>
            </div>
        </main>
    </div>

    <div id="slash-menu" class="popup-menu">
        <div class="menu-head">基础</div>
        <div class="menu-item" onclick="App.transform('text')">📄 文本</div>
        <div class="menu-item" onclick="App.transform('h1')">H1 标题</div>
        <div class="menu-item" onclick="App.transform('todo')">☑ 待办</div>
        <div class="menu-item" onclick="App.createSubPage()">📂 子页面</div>
        <div class="menu-head">高级视图</div>
        <div class="menu-item" onclick="App.transform('kanban')">📊 看板</div>
        <div class="menu-item" onclick="App.transform('timeline-h')">📅 横向时间轴</div>
        <div class="menu-item" onclick="App.transform('timeline-v')">⏱ 垂直时间轴</div>
        <div class="menu-item" onclick="App.transform('table')">▦ 表格</div>
    </div>

    <div id="event-modal" class="modal-overlay">
        <div class="modal">
            <h3>编辑事件</h3>
            <div class="form-group"><label>标题</label><input id="ev-title" class="form-input"></div>
            <div class="form-group"><label>日期</label><input type="date" id="ev-start" class="form-input"></div>
            <div class="form-group"><label>天数</label><input type="number" id="ev-duration" class="form-input"></div>
            <div class="form-group"><label>状态</label>
                <select id="ev-status" class="form-input">
                    <option value="doing">进行中</option>
                    <option value="done">已完成</option>
                    <option value="todo">未开始</option>
                    <option value="blocked">阻塞</option>
                    <option value="milestone">里程碑</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="Modal.close()">取消</button>
                <button class="btn primary" onclick="Modal.save()">保存</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/data.js"></script>
    <script type="module" src="js/modules.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>