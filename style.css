/* style.css */
:root {
    --bg-body: #ffffff; --bg-sidebar: #f7f9fb; --bg-panel: #ffffff; --bg-hover: #f0f2f5;
    --text-main: #1d1d1f; --text-sub: #6e6e73; --text-hint: #86868b;
    --accent: #0066cc; --border: #d2d2d7; --border-light: #e5e5e5;
    --sidebar-w: 260px; --header-h: 52px; --content-w: 960px;
    
    /* 状态色 */
    --status-doing: #FFD740; --bg-doing: rgba(255, 215, 64, 0.15);
    --status-done: #66BB6A; --bg-done: rgba(102, 187, 106, 0.15);
    --status-todo: #B0BEC5; --bg-todo: rgba(176, 190, 197, 0.15);
    --status-blocked: #EF5350; --bg-blocked: rgba(239, 83, 80, 0.15);
    --status-milestone: #FBBC04;
}

[data-theme="dark"] {
    --bg-body: #1c1c1e; --bg-sidebar: #2c2c2e; --bg-panel: #2c2c2e; --bg-hover: #3a3a3c;
    --text-main: #f5f5f7; --text-sub: #aeaeb2; --border: #38383a;
}

* { box-sizing: border-box; outline: none; }
body { margin: 0; height: 100vh; font-family: sans-serif; background: var(--bg-body); color: var(--text-main); overflow: hidden; }
svg { width: 18px; height: 18px; fill: currentColor; display: block; opacity: 0.8; }

/* 布局 */
#app { display: none; height: 100vh; width: 100vw; }
.sidebar { width: var(--sidebar-w); background: var(--bg-sidebar); border-right: 1px solid var(--border-light); display: flex; flex-direction: column; flex-shrink: 0; transition: width 0.3s; z-index: 100; }
.sidebar.closed { width: 0; border: none; overflow: hidden; }
.sidebar-header { height: var(--header-h); display: flex; align-items: center; justify-content: space-between; padding: 0 16px; font-weight: 600; min-width: 260px; }
.sidebar-list { flex: 1; overflow-y: auto; padding: 8px; min-width: 260px; }
.sidebar-item { padding: 8px 12px; margin-bottom: 2px; border-radius: 6px; cursor: pointer; color: var(--text-main); font-size: 14px; }
.sidebar-item:hover { background: var(--bg-hover); }
.sidebar-item.active { background: var(--bg-hover); color: var(--accent); font-weight: 500; }
.sidebar-footer { padding: 12px; border-top: 1px solid var(--border-light); font-size: 12px; color: var(--text-hint); text-align: center; min-width: 260px; }

#main { flex: 1; display: flex; flex-direction: column; min-width: 0; }
.top-bar { height: var(--header-h); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 1px solid var(--border-light); }
#breadcrumb { font-size: 14px; color: var(--text-sub); margin-left: 10px; }
.editor-scroller { flex: 1; overflow-y: auto; overflow-x: hidden; }
.editor-container { max-width: var(--content-width); margin: 0 auto; padding: 60px 80px 150px; min-height: 80vh; }
.page-title { width: 100%; border: none; background: transparent; font-size: 36px; font-weight: 700; color: var(--text-main); margin-bottom: 32px; }

/* 内容块 */
.block-wrapper { position: relative; margin: 4px 0; padding: 2px 0; display: flex; align-items: flex-start; }
.gutter { position: absolute; left: -52px; top: 2px; width: 48px; height: 24px; display: flex; align-items: center; justify-content: flex-end; gap: 4px; opacity: 0; transition: opacity 0.2s; z-index: 10; }
.block-wrapper:hover .gutter { opacity: 1; }
.gutter-btn { width: 22px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-hint); border-radius: 4px; }
.gutter-btn:hover { background: var(--bg-hover); color: var(--text-main); }
.block-content { flex: 1; min-height: 24px; font-size: 16px; line-height: 1.6; outline: none; padding: 0 4px; }
.block-content:empty::before { content: attr(placeholder); color: var(--text-hint); pointer-events: none; }
[data-type="h1"] .block-content { font-size: 28px; font-weight: 700; margin-top: 16px; margin-bottom: 8px; }
.block-wrapper.drop-target { border-top: 2px solid var(--accent); }

/* 复杂模块通用 */
.module-card { width: 100%; margin: 12px 0; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
.module-toolbar { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; background: var(--bg-sidebar); border-bottom: 1px solid var(--border-light); }
.module-title { font-size: 13px; font-weight: 600; color: var(--text-main); border: none; background: transparent; width: 150px; }
.btn { padding: 6px 12px; border-radius: 4px; border: 1px solid var(--border); background: var(--bg-panel); font-size: 12px; cursor: pointer; }
.btn:hover { background: var(--bg-hover); }
.btn.primary { background: var(--accent); color: white; border: none; }
.icon-btn { padding: 4px; border-radius: 4px; background: transparent; border: none; cursor: pointer; }
.icon-btn:hover { background: var(--bg-hover); }

/* 横向时间轴 (Gantt) */
.horizontal-timeline { display: flex; flex-direction: column; height: 450px; overflow: hidden; }
.timeline-body { flex: 1; display: flex; overflow: hidden; position: relative; }
.track-headers { width: 160px; flex-shrink: 0; border-right: 1px solid var(--border-light); background: var(--bg-panel); z-index: 2; margin-top: 40px; }
.track-header-item { height: 50px; border-bottom: 1px solid var(--border-light); display: flex; align-items: center; padding: 0 12px; font-size: 13px; }
.timeline-content { flex: 1; overflow: auto; position: relative; display: flex; flex-direction: column; }
.time-scale { height: 40px; background: var(--bg-sidebar); border-bottom: 1px solid var(--border-light); display: flex; position: sticky; top: 0; z-index: 5; min-width: max-content; }
.time-unit { height: 100%; border-right: 1px solid var(--border-light); display: flex; align-items: center; justify-content: center; font-size: 12px; color: var(--text-sub); flex-shrink: 0; }
.tracks-container { position: relative; min-width: max-content; }
.timeline-track-row { height: 50px; border-bottom: 1px solid var(--border-light); position: relative; background-image: linear-gradient(90deg, var(--border-light) 1px, transparent 1px); background-size: var(--grid-width) 100%; }
.timeline-event { position: absolute; top: 10px; height: 30px; border-radius: 4px; padding: 0 8px; display: flex; align-items: center; cursor: pointer; font-size: 12px; color: var(--text-main); border-left: 4px solid var(--border); box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden; white-space: nowrap; }
.timeline-event:hover { z-index: 10; box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
.event-doing { border-left-color: var(--status-doing); background: var(--bg-doing); }
.event-done { border-left-color: var(--status-done); background: var(--bg-done); text-decoration: line-through; }
.event-milestone { width: 24px !important; height: 24px !important; border-radius: 50%; padding: 0; justify-content: center; border: 2px solid var(--status-milestone); background: #fff; top: 13px; }
.event-milestone::after { content: '★'; color: var(--status-milestone); font-size: 12px; }
.resize-handle { position: absolute; top: 0; bottom: 0; width: 8px; cursor: col-resize; z-index: 20; }
.resize-handle:hover { background: rgba(0,0,0,0.1); }
.resize-handle.left { left: 0; } .resize-handle.right { right: 0; }
.ht-fullscreen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 5000; padding: 20px; background: var(--bg-body); }
.ht-fullscreen .horizontal-timeline { height: 100%; margin: 0; }

/* 垂直时间轴 */
.v-timeline-wrapper { padding: 20px 20px 20px 40px; position: relative; }
.v-timeline-line { position: absolute; left: 24px; top: 20px; bottom: 20px; width: 2px; background: var(--bg-hover); }
.vt-item { position: relative; margin-bottom: 20px; }
.vt-dot { position: absolute; left: -21px; top: 16px; width: 12px; height: 12px; border-radius: 50%; background: var(--bg-panel); border: 2px solid var(--accent); z-index: 2; }
.vt-card { background: var(--bg-sidebar); border-radius: 8px; padding: 12px; }
.vt-header { font-weight: 600; margin-bottom: 4px; outline: none; }
.vt-meta { font-size: 12px; color: var(--text-sub); display: flex; gap: 8px; }

/* 看板 */
.kanban-board { display: flex; padding: 12px; gap: 12px; overflow-x: auto; }
.kb-column { width: 260px; flex-shrink: 0; background: var(--bg-sidebar); border-radius: 8px; border: 1px solid var(--border-light); display: flex; flex-direction: column; max-height: 500px; }
.kb-header { padding: 10px; font-weight: 600; font-size: 14px; }
.kb-list { padding: 8px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; min-height: 50px; }
.kb-card { background: var(--bg-panel); padding: 10px; border-radius: 6px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); cursor: grab; }

/* 其他 */
.popup-menu { position: fixed; z-index: 6000; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 8px; width: 200px; padding: 6px 0; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
.popup-menu.show { display: block; }
.menu-item { padding: 8px 12px; font-size: 14px; cursor: pointer; }
.menu-item:hover { background: var(--bg-hover); color: var(--accent); }
.modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.4); z-index: 7000; display:none; align-items:center; justify-content:center; }
.modal { background: var(--bg-panel); padding: 24px; border-radius: 12px; width: 360px; }
.form-group { margin-bottom: 16px; }
.form-input { width: 100%; padding: 8px; border: 1px solid var(--border-light); border-radius: 4px; }
.bottom-trigger { height: 150px; display: flex; align-items: center; justify-content: center; color: var(--text-hint); cursor: text; margin-top: 40px; border-top: 1px dashed var(--border-light); }
.bottom-trigger:hover::after { content: "点击此处继续输入..."; }
#welcome-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 9999; display: flex; align-items: center; justify-content: center; }